# Accessibility testing bookmarklets that work with the Shadow DOM
Often taken from other bookmarklets and then heavily altering for my use cases


## Bookmarklets
- aName - Shows the various pieces for accessible name calculation; includes state, role, element, etc.
```
javascript:(function(){"use strict";function aName(){m();m();const e="font-weight:bold;color:#99f170;background:#333;display:inline-block;padding:3px;",t="color:pink;background:#333;padding:3px;",n=document.createElement("div"),a='<span aria-hidden="true">üëâüèΩ</span><span class="visually-hidden">Accessible name provided by</span> ',o='<span aria-hidden="true">üö®</span> <span class="visually-hidden">Warning</span>';let i="Accessible name: ",r="",l=!1,s=!1;function c(e,t,n){t=t.split("<").join("&lt;").split(">").join("&gt;"),r+='<li role="listitem"><span style="'+n+'">',l&&(r+=a),s&&(r+=o),r+=e+"</span>&nbsp;"+t+"</li>\n",t=t.replace("&lt;","<").replace("&gt;",">")}function d(){const e=document.createElement("button");e.textContent="Close (Esc)",e.setAttribute("type","button"),e.setAttribute("class","panel-btn"),e.addEventListener("click",(()=>{u()}));const t=document.getElementById("aNamePanelContent");t.appendChild(e);const n=document.createElement("a");n.textContent="Download summary (S)",n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(function(){const e=f(document);let t="IMPORTANT DISCLAIMER!\n\nThis text file is a *very approximate representation* \nof what this page may be like for screen reader users:\n\n";return e.forEach((e=>{const{name:n}=p(e),a=b(e);let o="N/A";if(e.hasAttribute("aria-describedby")){const t=e.getAttribute("aria-describedby").split(" "),n=e.getRootNode();o=t.map((e=>{const t=n.querySelector(`#${e}`);return t?t.textContent:""})).join(" ")}t+=`Accessible Name: ${n}, Role: ${a}, Description: ${o}\n`})),t}())),n.setAttribute("download","summary.txt"),t.appendChild(n)}function u(){document.querySelector("#aNamePanel")&&document.querySelector("#aNamePanel").remove(),document.querySelector("#panelStyles")&&document.querySelector("#panelStyles").remove(),document.querySelector("#focusStyles")&&document.querySelector("#focusStyles").remove(),document.removeEventListener("focusin",y)}function m(e=document){const t=e.activeElement;if(!t)return null;if(t.shadowRoot){return m(t.shadowRoot)||t}return t}function p(e){if(e.hasAttribute("aria-label"))return{name:e.getAttribute("aria-label"),source:"aria-label"};if(e.hasAttribute("aria-labelledby")){const t=e.getAttribute("aria-labelledby").split(" "),n=e.getRootNode(),a=t.map((e=>{const t=n.querySelector(`#${e}`);return t?t.textContent:""})).join(" ");if(a)return{name:a,source:"aria-labelledby"}}const t=e.closest("label");if(t)return{name:t.textContent.trim(),source:"<label> text"};if(e.id){const t=e.getRootNode().querySelector(`label[for="${e.id}"]`);if(t)return{name:t.textContent.trim(),source:"<label> text"}}return e.textContent.trim()?{name:e.textContent.trim(),source:"Inner text content"}:e.hasAttribute("title")?{name:e.getAttribute("title"),source:"title attribute"}:{name:"",source:"N/A"}}function b(e){let t=e.getAttribute("role"),n=e.tagName.toLowerCase();if(t)return t;if("button"===n)return"button";if("a"===n)return"link";if("input"===n){let t=e.getAttribute("type")?e.getAttribute("type").toLowerCase():"text";return["button","image","reset","submit"].includes(t)?"button":"checkbox"===t||"radio"===t?t:"textbox"}return["select","textarea"].includes(n)?"textbox":"generic"}function f(e){const t=[...e.querySelectorAll('a[href],button,select,input:not([type="hidden"]),textarea,summary,area,[tabindex]:not(#aNamePanel):not([tabindex^="-1"]),[contenteditable]:not([contenteditable="false"])')];return e.querySelectorAll("*").forEach((e=>{e.shadowRoot&&t.push(...f(e.shadowRoot))})),t}function y(a){let o=a.target;setTimeout((()=>{const a=m();a&&a!==o&&(o=a),o.classList.add("aNameTempFocusStyle"),r="";const l=o.tagName.toLowerCase();let u="<"+l+">";o.getAttribute("role")&&(u="<"+l+' role="'+o.getAttribute("role")+'">');const{name:f,source:y}=p(o);""===f?(s=!0,n.classList.add("error"),c(i+"No accessible name!","",t),c("Accessible Name Source: N/A","",t)):(n.classList.remove("error"),c(i,f,e),c("Accessible Name Source: ",y,e)),o.hasAttribute("data-dupe")&&(n.classList.add("warning"),c("Duplicate warning!","Another element has the same accessible name",t)),s=!1;const h=function(e){const t={"aria-busy":"busy","aria-checked":"checked","aria-current":"current","aria-disabled":"disabled","aria-expanded":"expanded","aria-grabbed":"grabbed","aria-hidden":"hidden","aria-invalid":"invalid","aria-pressed":"pressed","aria-selected":"selected","aria-haspopup":"haspopup","aria-readonly":"readonly","aria-required":"required","aria-modal":"modal","aria-multiline":"multiline","aria-multiselectable":"multiselectable",disabled:"disabled",required:"required",readonly:"readonly",checked:"checked",selected:"selected",hidden:"hidden",open:"open",multiple:"multiple",autofocus:"autofocus",draggable:"draggable",contenteditable:"contenteditable",spellcheck:"spellcheck"};let n=[e];const a=e.getRootNode();a&&a.host&&n.push(a.host);const o=e.closest(":defined");o&&o!==e&&n.push(o);const i=new Set;return"radio"!==e.type&&"checkbox"!==e.type||e.checked&&i.add("checked"),n.forEach((n=>{for(const[e,a]of Object.entries(t))if(n.hasAttribute(e)){const t=n.getAttribute(e);if("false"===t||null===t)continue;e.startsWith("aria-")&&"true"!==t&&t!==e&&""!==t||i.add(a)}n!==e&&n.tagName&&n.tagName.includes("-")&&(!0===n.checked||n.hasAttribute("checked")&&"false"!==n.getAttribute("checked"))&&i.add("checked")})),Array.from(i).join(" ")}(o);h&&c("State: ",h,e);if(c("Role: ",b(o),e),o.getAttribute("aria-describedby")){const t=o.getAttribute("aria-describedby").split(" "),n=o.getRootNode();c("Accessible Description: ",t.map((e=>{const t=n.querySelector(`#${e}`);return t?t.textContent:""})).join(" "),e)}else c("Accessible Description: ","N/A",e);c("HTML Element: ",u,e);document.getElementById("aNamePanelContent").innerHTML='<ul role="list">'+r+"</ul>",d()}),0)}u(),function(e){const t=document.createElement("style");t.setAttribute("type","text/css"),t.setAttribute("id","focusStyles"),t.textContent="#aNamePanel.error {background:darkred;} #aNamePanel.warning {background:#CC3300;} #aNamePanel[hidden] {display:none;} #aNamePanel * {text-align:left; pointer-events: auto;} #aNamePanel {border:2px solid #fff;z-index:1000;text-shadow:none;font-family:sans-serif;display:block;text-align:left;position: fixed;z-index:10000;background: black;padding: 20px 20px;width:"+e+"px;font-size:16px;bottom:20px;right:20px; pointer-events: none;} #aNamePanel button {font-weight:bold;background:none;color:#fff;padding:3px 10px;font-size:14px;border:1px solid #fff;display:inline-block;margin:10px 1em -10px 0;} #aNamePanel ul,#aNamePanel li {margin:0;padding:0;list-style:none} #aNamePanel li {margin:3px 0;background:#fff!important;color:#333!important;padding:2px} #aNamePanel details summary {color:white} #aNamePanel a[download]{display:block;margin:0.5em 0;color:#fff;text-decoration:underline;border:none;padding:0;}",document.querySelector("head").appendChild(t)}(400),function(){n.setAttribute("id","aNamePanel"),n.setAttribute("aria-live","polite"),n.setAttribute("tabindex","-1"),n.setAttribute("role","region"),n.setAttribute("aria-label","Accessibility properties panel");const e=document.createElement("div");e.setAttribute("id","aNamePanelHeader"),e.style.cursor="move",e.style.padding="10px",e.style.backgroundColor="#333",e.style.color="white",e.textContent="aName Panel (Drag Me)",n.appendChild(e);const t=document.createElement("div");t.setAttribute("id","aNamePanelContent"),n.appendChild(t),document.querySelector("body").appendChild(n),window.addEventListener("keyup",(e=>{"Escape"===e.key&&document.querySelector("#aNamePanel")&&u(),"s"===e.key.toLowerCase()&&document.querySelector("#aNamePanel")&&document.querySelector("#aNamePanel a[download]").click()})),function(e){var t=0,n=0,a=0,o=0;document.getElementById(e.id+"Header")?document.getElementById(e.id+"Header").onmousedown=i:e.onmousedown=i;function i(e){(e=e||window.event).preventDefault(),a=e.clientX,o=e.clientY,document.onmouseup=l,document.onmousemove=r}function r(i){(i=i||window.event).preventDefault(),t=a-i.clientX,n=o-i.clientY,a=i.clientX,o=i.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null}}(n)}(),function(){const e=document.createElement("style");e.setAttribute("type","text/css"),e.setAttribute("id","panelStyles"),e.textContent=".aNameTempFocusStyle:focus {outline:7px solid black!important;outline-offset:7px!important;overflow:visible;} .visually-hidden {clip-path: inset(100%);clip: rect(1px, 1px, 1px, 1px);height: 1px;overflow: hidden;position: absolute;white-space: nowrap;width: 1px;}",document.querySelector("body").appendChild(e)}(),function(){const e=f(document),t=new Map;e.forEach((e=>{const{name:n}=p(e);n&&(t.has(n)?t.get(n).push(e):t.set(n,[e]))})),t.forEach(((e,t)=>{e.length>1&&e.forEach((e=>e.setAttribute("data-dupe","true")))}))}(),document.addEventListener("focusin",y);const h=m();h&&y({target:h})}aName();}());
```
- 
